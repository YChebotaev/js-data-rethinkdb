{"version":3,"file":"js-data-rethinkdb.js","sources":["../src/index.js"],"sourcesContent":["let rethinkdbdash = require('rethinkdbdash')\nlet JSData = require('js-data')\nlet { DSUtils } = JSData\nlet { upperCase, contains, forOwn, isEmpty, keys, deepMixIn, forEach, isObject, isString, removeCircular, omit } = DSUtils\n\nlet underscore = require('mout/string/underscore')\n\nconst reserved = [\n  'orderBy',\n  'sort',\n  'limit',\n  'offset',\n  'skip',\n  'where'\n]\n\nconst addHiddenPropsToTarget = function (target, props) {\n  DSUtils.forOwn(props, function (value, key) {\n    props[key] = {\n      writable: true,\n      value\n    }\n  })\n  Object.defineProperties(target, props)\n}\n\nconst fillIn = function (dest, src) {\n  DSUtils.forOwn(src, function (value, key) {\n    if (!dest.hasOwnProperty(key) || dest[key] === undefined) {\n      dest[key] = value\n    }\n  })\n}\n\nconst unique = function (array) {\n  const seen = {}\n  const final = []\n  array.forEach(function (item) {\n    if (item in seen) {\n      return\n    }\n    final.push(item)\n    seen[item] = 0\n  })\n  return final\n}\n\nclass Defaults {\n\n}\n\naddHiddenPropsToTarget(Defaults.prototype, {\n  host: 'localhost',\n  port: 28015,\n  authKey: '',\n  db: 'test',\n  min: 10,\n  max: 50,\n  bufferSize: 10\n})\n\n/**\n * RethinkDBAdapter class.\n *\n * @example\n * import {DS} from 'js-data'\n * import RethinkDBAdapter from 'js-data-rethinkdb'\n * const store = new DS()\n * const adapter = new RethinkDBAdapter()\n * store.registerAdapter('rethinkdb', adapter, { 'default': true })\n *\n * @class RethinkDBAdapter\n * @param {Object} [opts] Configuration opts.\n * @param {string} [opts.host='localhost'] TODO\n * @param {number} [opts.port=28015] TODO\n * @param {string} [opts.authKey=''] TODO\n * @param {string} [opts.db='test'] TODO\n * @param {number} [opts.min=10] TODO\n * @param {number} [opts.max=50] TODO\n * @param {number} [opts.bufferSize=10] TODO\n */\nexport default function RethinkDBAdapter (opts) {\n  const self = this\n\n  self.defaults = new Defaults()\n  deepMixIn(self.defaults, opts)\n  fillIn(self, opts)\n  self.r = rethinkdbdash(self.defaults)\n  self.databases = {}\n  self.tables = {}\n  self.indices = {}\n}\n\naddHiddenPropsToTarget(RethinkDBAdapter.prototype, {\n  _handleErrors (cursor) {\n    if (cursor && cursor.errors > 0) {\n      if (cursor.first_error) {\n        throw new Error(cursor.first_error)\n      }\n      throw new Error('Unknown RethinkDB Error')\n    }\n  },\n\n  selectTable (Resource, opts) {\n    return this.r.db(opts.db || this.defaults.db).table(Resource.table || underscore(Resource.name))\n  },\n\n  filterSequence (sequence, params) {\n    let r = this.r\n    params = params || {}\n    params.where = params.where || {}\n    params.orderBy = params.orderBy || params.sort\n    params.skip = params.skip || params.offset\n\n    forEach(keys(params), function (k) {\n      let v = params[k]\n      if (!contains(reserved, k)) {\n        if (isObject(v)) {\n          params.where[k] = v\n        } else {\n          params.where[k] = {\n            '==': v\n          }\n        }\n        delete params[k]\n      }\n    })\n\n    let query = sequence\n\n    if (!isEmpty(params.where)) {\n      query = query.filter((row) => {\n        let subQuery\n        forOwn(params.where, function (criteria, field) {\n          if (!isObject(criteria)) {\n            criteria = {'==': criteria}\n          }\n          forOwn(criteria, function (v, op) {\n            if (op === '==' || op === '===') {\n              subQuery = subQuery ? subQuery.and(row(field).default(null).eq(v)) : row(field).default(null).eq(v)\n            } else if (op === '!=' || op === '!==') {\n              subQuery = subQuery ? subQuery.and(row(field).default(null).ne(v)) : row(field).default(null).ne(v)\n            } else if (op === '>') {\n              subQuery = subQuery ? subQuery.and(row(field).default(null).gt(v)) : row(field).default(null).gt(v)\n            } else if (op === '>=') {\n              subQuery = subQuery ? subQuery.and(row(field).default(null).ge(v)) : row(field).default(null).ge(v)\n            } else if (op === '<') {\n              subQuery = subQuery ? subQuery.and(row(field).default(null).lt(v)) : row(field).default(null).lt(v)\n            } else if (op === '<=') {\n              subQuery = subQuery ? subQuery.and(row(field).default(null).le(v)) : row(field).default(null).le(v)\n            } else if (op === 'isectEmpty') {\n              subQuery = subQuery ? subQuery.and(row(field).default([]).setIntersection(r.expr(v).default([])).count().eq(0)) : row(field).default([]).setIntersection(r.expr(v).default([])).count().eq(0)\n            } else if (op === 'isectNotEmpty') {\n              subQuery = subQuery ? subQuery.and(row(field).default([]).setIntersection(r.expr(v).default([])).count().ne(0)) : row(field).default([]).setIntersection(r.expr(v).default([])).count().ne(0)\n            } else if (op === 'in') {\n              subQuery = subQuery ? subQuery.and(r.expr(v).default(r.expr([])).contains(row(field).default(null))) : r.expr(v).default(r.expr([])).contains(row(field).default(null))\n            } else if (op === 'notIn') {\n              subQuery = subQuery ? subQuery.and(r.expr(v).default(r.expr([])).contains(row(field).default(null)).not()) : r.expr(v).default(r.expr([])).contains(row(field).default(null)).not()\n            } else if (op === '|==' || op === '|===') {\n              subQuery = subQuery ? subQuery.or(row(field).default(null).eq(v)) : row(field).default(null).eq(v)\n            } else if (op === '|!=' || op === '|!==') {\n              subQuery = subQuery ? subQuery.or(row(field).default(null).ne(v)) : row(field).default(null).ne(v)\n            } else if (op === '|>') {\n              subQuery = subQuery ? subQuery.or(row(field).default(null).gt(v)) : row(field).default(null).gt(v)\n            } else if (op === '|>=') {\n              subQuery = subQuery ? subQuery.or(row(field).default(null).ge(v)) : row(field).default(null).ge(v)\n            } else if (op === '|<') {\n              subQuery = subQuery ? subQuery.or(row(field).default(null).lt(v)) : row(field).default(null).lt(v)\n            } else if (op === '|<=') {\n              subQuery = subQuery ? subQuery.or(row(field).default(null).le(v)) : row(field).default(null).le(v)\n            } else if (op === '|isectEmpty') {\n              subQuery = subQuery ? subQuery.or(row(field).default([]).setIntersection(r.expr(v).default([])).count().eq(0)) : row(field).default([]).setIntersection(r.expr(v).default([])).count().eq(0)\n            } else if (op === '|isectNotEmpty') {\n              subQuery = subQuery ? subQuery.or(row(field).default([]).setIntersection(r.expr(v).default([])).count().ne(0)) : row(field).default([]).setIntersection(r.expr(v).default([])).count().ne(0)\n            } else if (op === '|in') {\n              subQuery = subQuery ? subQuery.or(r.expr(v).default(r.expr([])).contains(row(field).default(null))) : r.expr(v).default(r.expr([])).contains(row(field).default(null))\n            } else if (op === '|notIn') {\n              subQuery = subQuery ? subQuery.or(r.expr(v).default(r.expr([])).contains(row(field).default(null)).not()) : r.expr(v).default(r.expr([])).contains(row(field).default(null)).not()\n            }\n          })\n        })\n        return subQuery\n      })\n    }\n\n    if (params.orderBy) {\n      if (isString(params.orderBy)) {\n        params.orderBy = [\n          [params.orderBy, 'asc']\n        ]\n      }\n      for (var i = 0; i < params.orderBy.length; i++) {\n        if (isString(params.orderBy[i])) {\n          params.orderBy[i] = [params.orderBy[i], 'asc']\n        }\n        query = upperCase(params.orderBy[i][1]) === 'DESC' ? query.orderBy(r.desc(params.orderBy[i][0])) : query.orderBy(params.orderBy[i][0])\n      }\n    }\n\n    if (params.skip) {\n      query = query.skip(+params.skip)\n    }\n\n    if (params.limit) {\n      query = query.limit(+params.limit)\n    }\n\n    return query\n  },\n\n  waitForDb (opts) {\n    const self = this\n    opts = opts || {}\n    let db = opts.db || self.defaults.db\n    if (!self.databases[db]) {\n      self.databases[db] = self.r.branch(\n        self.r.dbList().contains(db),\n        true,\n        self.r.dbCreate(db)\n      ).run()\n    }\n    return self.databases[db]\n  },\n\n  /**\n   * Create a new record.\n   *\n   * @name RethinkDBAdapter#create\n   * @method\n   * @param {Object} Resource The Resource.\n   * @param {Object} props The record to be created.\n   * @param {Object} [opts] Configuration options.\n   * @return {Promise}\n   */\n  create (Resource, props, opts) {\n    const self = this\n    props = removeCircular(omit(props, Resource.relationFields || []))\n    opts || (opts = {})\n\n    return self.waitForTable(Resource.table || underscore(Resource.name), opts).then(function () {\n      return self.selectTable(Resource, opts).insert(props, {returnChanges: true}).run()\n    }).then(function (cursor) {\n      self._handleErrors(cursor)\n      return cursor.changes[0].new_val\n    })\n  },\n\n  /**\n   * Destroy the record with the given primary key.\n   *\n   * @name RethinkDBAdapter#destroy\n   * @method\n   * @param {Object} Resource The Resource.\n   * @param {(string|number)} id Primary key of the record to destroy.\n   * @param {Object} [opts] Configuration options.\n   * @return {Promise}\n   */\n  destroy (Resource, id, opts) {\n    const self = this\n    opts || (opts = {})\n\n    return self.waitForTable(Resource.table || underscore(Resource.name), opts).then(function () {\n      return self.selectTable(Resource, opts).get(id).delete().run()\n    }).then(function () {\n      return undefined\n    })\n  },\n\n  /**\n   * Destroy the records that match the selection query.\n   *\n   * @name RethinkDBAdapter#destroyAll\n   * @method\n   * @param {Object} Resource the Resource.\n   * @param {Object} [query] Selection query.\n   * @param {Object} [opts] Configuration options.\n   * @return {Promise}\n   */\n  destroyAll (Resource, query, opts) {\n    const self = this\n    query || (query = {})\n    opts || (opts = {})\n\n    return self.waitForTable(Resource.table || underscore(Resource.name), opts).then(function () {\n      return self.filterSequence(self.selectTable(Resource, opts), query).delete().run()\n    }).then(function () {\n      return undefined\n    })\n  },\n\n  /**\n   * TODO\n   *\n   * There may be reasons why you may want to override this method, like when\n   * the id of the parent doesn't exactly match up to the key on the child.\n   *\n   * @name RethinkDBAdapter#makeHasManyForeignKey\n   * @method\n   * @return {*}\n   */\n  makeHasManyForeignKey (Resource, def, record) {\n    return DSUtils.get(record, Resource.idAttribute)\n  },\n\n  /**\n   * TODO\n   *\n   * @name RethinkDBAdapter#loadHasMany\n   * @method\n   * @return {Promise}\n   */\n  loadHasMany (Resource, def, records, __options) {\n    const self = this\n    let singular = false\n\n    if (DSUtils.isObject(records) && !DSUtils.isArray(records)) {\n      singular = true\n      records = [records]\n    }\n    const IDs = records.map(function (record) {\n      return self.makeHasManyForeignKey(Resource, def, record)\n    })\n    const query = {}\n    const criteria = query[def.foreignKey] = {}\n    if (singular) {\n      // more efficient query when we only have one record\n      criteria['=='] = IDs[0]\n    } else {\n      criteria['in'] = IDs.filter(function (id) {\n        return id\n      })\n    }\n    return self.findAll(Resource.getResource(def.relation), query, __options).then(function (relatedItems) {\n      records.forEach(function (record) {\n        let attached = []\n        // avoid unneccesary iteration when we only have one record\n        if (singular) {\n          attached = relatedItems\n        } else {\n          relatedItems.forEach(function (relatedItem) {\n            if (DSUtils.get(relatedItem, def.foreignKey) === record[Resource.idAttribute]) {\n              attached.push(relatedItem)\n            }\n          })\n        }\n        DSUtils.set(record, def.localField, attached)\n      })\n    })\n  },\n\n  /**\n   * TODO\n   *\n   * @name RethinkDBAdapter#loadHasOne\n   * @method\n   * @return {Promise}\n   */\n  loadHasOne (Resource, def, records, __options) {\n    if (DSUtils.isObject(records) && !DSUtils.isArray(records)) {\n      records = [records]\n    }\n    return this.loadHasMany(Resource, def, records, __options).then(function () {\n      records.forEach(function (record) {\n        const relatedData = DSUtils.get(record, def.localField)\n        if (DSUtils.isArray(relatedData) && relatedData.length) {\n          DSUtils.set(record, def.localField, relatedData[0])\n        }\n      })\n    })\n  },\n\n  /**\n   * TODO\n   *\n   * @name RethinkDBAdapter#makeBelongsToForeignKey\n   * @method\n   * @return {*}\n   */\n  makeBelongsToForeignKey (Resource, def, record) {\n    return DSUtils.get(record, def.localKey)\n  },\n\n  /**\n   * TODO\n   *\n   * @name RethinkDBAdapter#loadBelongsTo\n   * @method\n   * @return {Promise}\n   */\n  loadBelongsTo (Resource, def, records, __options) {\n    const self = this\n    const relationDef = Resource.getResource(def.relation)\n\n    if (DSUtils.isObject(records) && !DSUtils.isArray(records)) {\n      const record = records\n      return self.find(relationDef, self.makeBelongsToForeignKey(Resource, def, record), __options).then(function (relatedItem) {\n        DSUtils.set(record, def.localField, relatedItem)\n      })\n    } else {\n      const keys = records.map(function (record) {\n        return self.makeBelongsToForeignKey(Resource, def, record)\n      }).filter(function (key) {\n        return key\n      })\n      return self.findAll(relationDef, {\n        where: {\n          [relationDef.idAttribute]: {\n            'in': keys\n          }\n        }\n      }, __options).then(function (relatedItems) {\n        records.forEach(function (record) {\n          relatedItems.forEach(function (relatedItem) {\n            if (relatedItem[relationDef.idAttribute] === record[def.localKey]) {\n              DSUtils.set(record, def.localField, relatedItem)\n            }\n          })\n        })\n      })\n    }\n  },\n\n  /**\n   * Retrieve the record with the given primary key.\n   *\n   * @name RethinkDBAdapter#find\n   * @method\n   * @param {Object} Resource The Resource.\n   * @param {(string|number)} id Primary key of the record to retrieve.\n   * @param {Object} [opts] Configuration options.\n   * @param {string[]} [opts.with=[]] TODO\n   * @return {Promise}\n   */\n  find (Resource, id, opts) {\n    const self = this\n    opts || (opts = {})\n    opts.with || (opts.with = [])\n\n    let instance\n    const table = Resource.table || underscore(Resource.name)\n    const relationList = Resource.relationList || []\n    let tasks = [self.waitForTable(table, opts)]\n\n    relationList.forEach(function (def) {\n      const relationName = def.relation\n      const relationDef = Resource.getResource(relationName)\n      if (!relationDef) {\n        throw new JSData.DSErrors.NER(relationName)\n      } else if (!opts.with || !contains(opts.with, relationName)) {\n        return\n      }\n      if (def.foreignKey) {\n        tasks.push(self.waitForIndex(relationDef.table || underscore(relationDef.name), def.foreignKey, opts))\n      } else if (def.localKey) {\n        tasks.push(self.waitForIndex(Resource.table || underscore(Resource.name), def.localKey, opts))\n      }\n    })\n    return DSUtils.Promise.all(tasks).then(function () {\n      return self.selectTable(Resource, opts).get(id).run()\n    }).then(function (_instance) {\n      if (!_instance) {\n        throw new Error('Not Found!')\n      }\n      instance = _instance\n      let tasks = []\n\n      relationList.forEach(function (def) {\n        let relationName = def.relation\n        let relationDef = Resource.getResource(relationName)\n        let containedName = null\n        if (opts.with.indexOf(relationName) !== -1) {\n          containedName = relationName\n        } else if (opts.with.indexOf(def.localField) !== -1) {\n          containedName = def.localField\n        }\n        if (containedName) {\n          let __options = DSUtils.deepMixIn({}, opts.orig ? opts.orig() : opts)\n          __options.with = opts.with.slice()\n          __options = DSUtils._(relationDef, __options)\n          DSUtils.remove(__options.with, containedName)\n          __options.with.forEach(function (relation, i) {\n            if (relation && relation.indexOf(containedName) === 0 && relation.length >= containedName.length && relation[containedName.length] === '.') {\n              __options.with[i] = relation.substr(containedName.length + 1)\n            } else {\n              __options.with[i] = ''\n            }\n          })\n\n          let task\n\n          if (def.foreignKey && (def.type === 'hasOne' || def.type === 'hasMany')) {\n            if (def.type === 'hasOne') {\n              task = self.loadHasOne(Resource, def, instance, __options)\n            } else {\n              task = self.loadHasMany(Resource, def, instance, __options)\n            }\n          } else if (def.type === 'hasMany' && def.localKeys) {\n            let localKeys = []\n            let itemKeys = instance[def.localKeys] || []\n            itemKeys = DSUtils.isArray(itemKeys) ? itemKeys : DSUtils.keys(itemKeys)\n            localKeys = localKeys.concat(itemKeys || [])\n            task = self.findAll(Resource.getResource(relationName), {\n              where: {\n                [relationDef.idAttribute]: {\n                  'in': unique(localKeys).filter((x) => x)\n                }\n              }\n            }, __options).then(function (relatedItems) {\n              DSUtils.set(instance, def.localField, relatedItems)\n              return relatedItems\n            })\n          } else if (def.type === 'belongsTo' || (def.type === 'hasOne' && def.localKey)) {\n            task = self.loadBelongsTo(Resource, def, instance, __options)\n          }\n\n          if (task) {\n            tasks.push(task)\n          }\n        }\n      })\n\n      return DSUtils.Promise.all(tasks)\n    }).then(function () {\n      return instance\n    })\n  },\n\n  /**\n   * Retrieve the records that match the selection query.\n   *\n   * @name RethinkDBAdapter#findAll\n   * @method\n   * @param {Object} Resource The Resource.\n   * @param {Object} query Selection query.\n   * @param {Object} [opts] Configuration options.\n   * @param {string[]} [opts.with=[]] TODO\n   * @return {Promise}\n   */\n  findAll (Resource, query, opts) {\n    const self = this\n    opts || (opts = {})\n    opts.with || (opts.with = [])\n\n    let items = null\n    const table = Resource.table || underscore(Resource.name)\n    const relationList = Resource.relationList || []\n    let tasks = [self.waitForTable(table, opts)]\n\n    relationList.forEach(function (def) {\n      const relationName = def.relation\n      const relationDef = Resource.getResource(relationName)\n      if (!relationDef) {\n        throw new JSData.DSErrors.NER(relationName)\n      } else if (!opts.with || !contains(opts.with, relationName)) {\n        return\n      }\n      if (def.foreignKey) {\n        tasks.push(self.waitForIndex(relationDef.table || underscore(relationDef.name), def.foreignKey, opts))\n      } else if (def.localKey) {\n        tasks.push(self.waitForIndex(Resource.table || underscore(Resource.name), def.localKey, opts))\n      }\n    })\n    return DSUtils.Promise.all(tasks).then(function () {\n      return self.filterSequence(self.selectTable(Resource, opts), query).run()\n    }).then(function (_items) {\n      items = _items\n      let tasks = []\n      const relationList = Resource.relationList || []\n      relationList.forEach(function (def) {\n        let relationName = def.relation\n        let relationDef = Resource.getResource(relationName)\n        let containedName = null\n        if (opts.with.indexOf(relationName) !== -1) {\n          containedName = relationName\n        } else if (opts.with.indexOf(def.localField) !== -1) {\n          containedName = def.localField\n        }\n        if (containedName) {\n          let __options = DSUtils.deepMixIn({}, opts.orig ? opts.orig() : opts)\n          __options.with = opts.with.slice()\n          __options = DSUtils._(relationDef, __options)\n          DSUtils.remove(__options.with, containedName)\n          __options.with.forEach(function (relation, i) {\n            if (relation && relation.indexOf(containedName) === 0 && relation.length >= containedName.length && relation[containedName.length] === '.') {\n              __options.with[i] = relation.substr(containedName.length + 1)\n            } else {\n              __options.with[i] = ''\n            }\n          })\n\n          let task\n\n          if (def.foreignKey && (def.type === 'hasOne' || def.type === 'hasMany')) {\n            if (def.type === 'hasMany') {\n              task = self.loadHasMany(Resource, def, items, __options)\n            } else {\n              task = self.loadHasOne(Resource, def, items, __options)\n            }\n          } else if (def.type === 'hasMany' && def.localKeys) {\n            let localKeys = []\n            items.forEach(function (item) {\n              let itemKeys = item[def.localKeys] || []\n              itemKeys = DSUtils.isArray(itemKeys) ? itemKeys : Object.keys(itemKeys)\n              localKeys = localKeys.concat(itemKeys || [])\n            })\n            task = self.findAll(Resource.getResource(relationName), {\n              where: {\n                [relationDef.idAttribute]: {\n                  'in': unique(localKeys).filter((x) => x)\n                }\n              }\n            }, __options).then(function (relatedItems) {\n              items.forEach(function (item) {\n                let attached = []\n                let itemKeys = item[def.localKeys] || []\n                itemKeys = DSUtils.isArray(itemKeys) ? itemKeys : DSUtils.keys(itemKeys)\n                relatedItems.forEach(function (relatedItem) {\n                  if (itemKeys && itemKeys.indexOf(relatedItem[relationDef.idAttribute]) !== -1) {\n                    attached.push(relatedItem)\n                  }\n                })\n                DSUtils.set(item, def.localField, attached)\n              })\n              return relatedItems\n            })\n          } else if (def.type === 'belongsTo' || (def.type === 'hasOne' && def.localKey)) {\n            task = self.loadBelongsTo(Resource, def, items, __options)\n          }\n\n          if (task) {\n            tasks.push(task)\n          }\n        }\n      })\n      return DSUtils.Promise.all(tasks)\n    }).then(function () {\n      return items\n    })\n  },\n\n  /**\n   * Apply the given update to the record with the specified primary key.\n   *\n   * @name RethinkDBAdapter#update\n   * @method\n   * @param {Object} Resource The Resource.\n   * @param {(string|number)} id The primary key of the record to be updated.\n   * @param {Object} props The update to apply to the record.\n   * @param {Object} [opts] Configuration options.\n   * @return {Promise}\n   */\n  update (resourceConfig, id, attrs, options) {\n    attrs = removeCircular(omit(attrs, resourceConfig.relationFields || []))\n    options = options || {}\n    return this.waitForTable(resourceConfig.table || underscore(resourceConfig.name), options).then(() => {\n      return this.r.db(options.db || this.defaults.db).table(resourceConfig.table || underscore(resourceConfig.name)).get(id).update(attrs, {returnChanges: true}).run()\n    }).then((cursor) => {\n      this._handleErrors(cursor)\n      if (cursor.changes && cursor.changes.length && cursor.changes[0].new_val) {\n        return cursor.changes[0].new_val\n      } else {\n        return this.selectTable(resourceConfig, options).get(id).run()\n      }\n    })\n  },\n\n  /**\n   * Apply the given update to all records that match the selection query.\n   *\n   * @name RethinkDBAdapter#updateAll\n   * @method\n   * @param {Object} Resource The Resource.\n   * @param {Object} props The update to apply to the selected records.\n   * @param {Object} [query] Selection query.\n   * @param {Object} [opts] Configuration options.\n   * @return {Promise}\n   */\n  updateAll (resourceConfig, attrs, params, options) {\n    attrs = removeCircular(omit(attrs, resourceConfig.relationFields || []))\n    options = options || {}\n    params = params || {}\n    return this.waitForTable(resourceConfig.table || underscore(resourceConfig.name), options).then(() => {\n      return this.filterSequence(this.selectTable(resourceConfig, options), params).update(attrs, {returnChanges: true}).run()\n    }).then((cursor) => {\n      this._handleErrors(cursor)\n      if (cursor && cursor.changes && cursor.changes.length) {\n        let items = []\n        cursor.changes.forEach((change) => items.push(change.new_val))\n        return items\n      } else {\n        return this.filterSequence(this.selectTable(resourceConfig, options), params).run()\n      }\n    })\n  },\n\n  waitForTable (table, options) {\n    options = options || {}\n    let db = options.db || this.defaults.db\n    return this.waitForDb(options).then(() => {\n      this.tables[db] = this.tables[db] || {}\n      if (!this.tables[db][table]) {\n        this.tables[db][table] = this.r.branch(this.r.db(db).tableList().contains(table), true, this.r.db(db).tableCreate(table)).run()\n      }\n      return this.tables[db][table]\n    })\n  },\n\n  waitForIndex (table, index, options) {\n    options = options || {}\n    let db = options.db || this.defaults.db\n    return this.waitForDb(options).then(() => this.waitForTable(table, options)).then(() => {\n      this.indices[db] = this.indices[db] || {}\n      this.indices[db][table] = this.indices[db][table] || {}\n      if (!this.tables[db][table][index]) {\n        this.tables[db][table][index] = this.r.branch(this.r.db(db).table(table).indexList().contains(index), true, this.r.db(db).table(table).indexCreate(index)).run().then(() => {\n          return this.r.db(db).table(table).indexWait(index).run()\n        })\n      }\n      return this.tables[db][table][index]\n    })\n  }\n})\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAI,gBAAgB,QAAQ,eAAR,CAAhB;AACJ,IAAI,SAAS,QAAQ,SAAR,CAAT;IACE,UAAY,OAAZ;IACA,YAA6G,QAA7G;IAAW,WAAkG,QAAlG;IAAU,SAAwF,QAAxF;IAAQ,UAAgF,QAAhF;IAAS,OAAuE,QAAvE;IAAM,YAAiE,QAAjE;IAAW,UAAsD,QAAtD;IAAS,WAA6C,QAA7C;IAAU,WAAmC,QAAnC;IAAU,iBAAyB,QAAzB;IAAgB,OAAS,QAAT;;;AAE1G,IAAI,aAAa,QAAQ,wBAAR,CAAb;;AAEJ,IAAM,WAAW,CACf,SADe,EAEf,MAFe,EAGf,OAHe,EAIf,QAJe,EAKf,MALe,EAMf,OANe,CAAX;;AASN,IAAM,yBAAyB,SAAzB,sBAAyB,CAAU,MAAV,EAAkB,KAAlB,EAAyB;UAC9C,MAAR,CAAe,KAAf,EAAsB,UAAU,KAAV,EAAiB,GAAjB,EAAsB;UACpC,GAAN,IAAa;gBACD,IAAV;kBADW;KAAb,CAD0C;GAAtB,CAAtB,CADsD;SAO/C,gBAAP,CAAwB,MAAxB,EAAgC,KAAhC,EAPsD;CAAzB;;AAU/B,IAAM,SAAS,SAAT,MAAS,CAAU,IAAV,EAAgB,GAAhB,EAAqB;UAC1B,MAAR,CAAe,GAAf,EAAoB,UAAU,KAAV,EAAiB,GAAjB,EAAsB;QACpC,CAAC,KAAK,cAAL,CAAoB,GAApB,CAAD,IAA6B,KAAK,GAAL,MAAc,SAAd,EAAyB;WACnD,GAAL,IAAY,KAAZ,CADwD;KAA1D;GADkB,CAApB,CADkC;CAArB;;AAQf,IAAM,SAAS,SAAT,MAAS,CAAU,KAAV,EAAiB;MACxB,OAAO,EAAP,CADwB;MAExB,QAAQ,EAAR,CAFwB;QAGxB,OAAN,CAAc,UAAU,IAAV,EAAgB;QACxB,QAAQ,IAAR,EAAc;aAAA;KAAlB;UAGM,IAAN,CAAW,IAAX,EAJ4B;SAKvB,IAAL,IAAa,CAAb,CAL4B;GAAhB,CAAd,CAH8B;SAUvB,KAAP,CAV8B;CAAjB;;IAaT;;;;AAIN,uBAAuB,SAAS,SAAT,EAAoB;QACnC,WAAN;QACM,KAAN;WACS,EAAT;MACI,MAAJ;OACK,EAAL;OACK,EAAL;cACY,EAAZ;CAPF;;;;;;;;;;;;;;;;;;;;;;AA8BA,AAAe,SAAS,gBAAT,CAA2B,IAA3B,EAAiC;MACxC,OAAO,IAAP,CADwC;;OAGzC,QAAL,GAAgB,IAAI,QAAJ,EAAhB,CAH8C;YAIpC,KAAK,QAAL,EAAe,IAAzB,EAJ8C;SAKvC,IAAP,EAAa,IAAb,EAL8C;OAMzC,CAAL,GAAS,cAAc,KAAK,QAAL,CAAvB,CAN8C;OAOzC,SAAL,GAAiB,EAAjB,CAP8C;OAQzC,MAAL,GAAc,EAAd,CAR8C;OASzC,OAAL,GAAe,EAAf,CAT8C;CAAjC;;AAYf,uBAAuB,iBAAiB,SAAjB,EAA4B;wCAClC,QAAQ;QACjB,UAAU,OAAO,MAAP,GAAgB,CAAhB,EAAmB;UAC3B,OAAO,WAAP,EAAoB;cAChB,IAAI,KAAJ,CAAU,OAAO,WAAP,CAAhB,CADsB;OAAxB;YAGM,IAAI,KAAJ,CAAU,yBAAV,CAAN,CAJ+B;KAAjC;GAF+C;oCAUpC,UAAU,MAAM;WACpB,KAAK,CAAL,CAAO,EAAP,CAAU,KAAK,EAAL,IAAW,KAAK,QAAL,CAAc,EAAd,CAArB,CAAuC,KAAvC,CAA6C,SAAS,KAAT,IAAkB,WAAW,SAAS,IAAT,CAA7B,CAApD,CAD2B;GAVoB;0CAcjC,UAAU,QAAQ;QAC5B,IAAI,KAAK,CAAL,CADwB;aAEvB,UAAU,EAAV,CAFuB;WAGzB,KAAP,GAAe,OAAO,KAAP,IAAgB,EAAhB,CAHiB;WAIzB,OAAP,GAAiB,OAAO,OAAP,IAAkB,OAAO,IAAP,CAJH;WAKzB,IAAP,GAAc,OAAO,IAAP,IAAe,OAAO,MAAP,CALG;;YAOxB,KAAK,MAAL,CAAR,EAAsB,UAAU,CAAV,EAAa;UAC7B,IAAI,OAAO,CAAP,CAAJ,CAD6B;UAE7B,CAAC,SAAS,QAAT,EAAmB,CAAnB,CAAD,EAAwB;YACtB,SAAS,CAAT,CAAJ,EAAiB;iBACR,KAAP,CAAa,CAAb,IAAkB,CAAlB,CADe;SAAjB,MAEO;iBACE,KAAP,CAAa,CAAb,IAAkB;kBACV,CAAN;WADF,CADK;SAFP;eAOO,OAAO,CAAP,CAAP,CAR0B;OAA5B;KAFoB,CAAtB,CAPgC;;QAqB5B,QAAQ,QAAR,CArB4B;;QAuB5B,CAAC,QAAQ,OAAO,KAAP,CAAT,EAAwB;cAClB,MAAM,MAAN,CAAa,UAAC,GAAD,EAAS;YACxB,oBAAJ,CAD4B;eAErB,OAAO,KAAP,EAAc,UAAU,QAAV,EAAoB,KAApB,EAA2B;cAC1C,CAAC,SAAS,QAAT,CAAD,EAAqB;uBACZ,EAAC,MAAM,QAAN,EAAZ,CADuB;WAAzB;iBAGO,QAAP,EAAiB,UAAU,CAAV,EAAa,EAAb,EAAiB;gBAC5B,OAAO,IAAP,IAAe,OAAO,KAAP,EAAc;yBACpB,WAAW,SAAS,GAAT,CAAa,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAb,CAAX,GAA0D,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAA1D,CADoB;aAAjC,MAEO,IAAI,OAAO,IAAP,IAAe,OAAO,KAAP,EAAc;yBAC3B,WAAW,SAAS,GAAT,CAAa,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAb,CAAX,GAA0D,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAA1D,CAD2B;aAAjC,MAEA,IAAI,OAAO,GAAP,EAAY;yBACV,WAAW,SAAS,GAAT,CAAa,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAb,CAAX,GAA0D,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAA1D,CADU;aAAhB,MAEA,IAAI,OAAO,IAAP,EAAa;yBACX,WAAW,SAAS,GAAT,CAAa,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAb,CAAX,GAA0D,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAA1D,CADW;aAAjB,MAEA,IAAI,OAAO,GAAP,EAAY;yBACV,WAAW,SAAS,GAAT,CAAa,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAb,CAAX,GAA0D,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAA1D,CADU;aAAhB,MAEA,IAAI,OAAO,IAAP,EAAa;yBACX,WAAW,SAAS,GAAT,CAAa,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAb,CAAX,GAA0D,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAA1D,CADW;aAAjB,MAEA,IAAI,OAAO,YAAP,EAAqB;yBACnB,WAAW,SAAS,GAAT,CAAa,IAAI,KAAJ,EAAW,OAAX,CAAmB,EAAnB,EAAuB,eAAvB,CAAuC,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAlB,CAAvC,EAA8D,KAA9D,GAAsE,EAAtE,CAAyE,CAAzE,CAAb,CAAX,GAAuG,IAAI,KAAJ,EAAW,OAAX,CAAmB,EAAnB,EAAuB,eAAvB,CAAuC,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAlB,CAAvC,EAA8D,KAA9D,GAAsE,EAAtE,CAAyE,CAAzE,CAAvG,CADmB;aAAzB,MAEA,IAAI,OAAO,eAAP,EAAwB;yBACtB,WAAW,SAAS,GAAT,CAAa,IAAI,KAAJ,EAAW,OAAX,CAAmB,EAAnB,EAAuB,eAAvB,CAAuC,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAlB,CAAvC,EAA8D,KAA9D,GAAsE,EAAtE,CAAyE,CAAzE,CAAb,CAAX,GAAuG,IAAI,KAAJ,EAAW,OAAX,CAAmB,EAAnB,EAAuB,eAAvB,CAAuC,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAlB,CAAvC,EAA8D,KAA9D,GAAsE,EAAtE,CAAyE,CAAzE,CAAvG,CADsB;aAA5B,MAEA,IAAI,OAAO,IAAP,EAAa;yBACX,WAAW,SAAS,GAAT,CAAa,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAE,IAAF,CAAO,EAAP,CAAlB,EAA8B,QAA9B,CAAuC,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,CAAvC,CAAb,CAAX,GAA4F,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAE,IAAF,CAAO,EAAP,CAAlB,EAA8B,QAA9B,CAAuC,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,CAAvC,CAA5F,CADW;aAAjB,MAEA,IAAI,OAAO,OAAP,EAAgB;yBACd,WAAW,SAAS,GAAT,CAAa,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAE,IAAF,CAAO,EAAP,CAAlB,EAA8B,QAA9B,CAAuC,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,CAAvC,EAAiE,GAAjE,EAAb,CAAX,GAAkG,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAE,IAAF,CAAO,EAAP,CAAlB,EAA8B,QAA9B,CAAuC,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,CAAvC,EAAiE,GAAjE,EAAlG,CADc;aAApB,MAEA,IAAI,OAAO,KAAP,IAAgB,OAAO,MAAP,EAAe;yBAC7B,WAAW,SAAS,EAAT,CAAY,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAZ,CAAX,GAAyD,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAzD,CAD6B;aAAnC,MAEA,IAAI,OAAO,KAAP,IAAgB,OAAO,MAAP,EAAe;yBAC7B,WAAW,SAAS,EAAT,CAAY,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAZ,CAAX,GAAyD,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAzD,CAD6B;aAAnC,MAEA,IAAI,OAAO,IAAP,EAAa;yBACX,WAAW,SAAS,EAAT,CAAY,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAZ,CAAX,GAAyD,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAzD,CADW;aAAjB,MAEA,IAAI,OAAO,KAAP,EAAc;yBACZ,WAAW,SAAS,EAAT,CAAY,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAZ,CAAX,GAAyD,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAzD,CADY;aAAlB,MAEA,IAAI,OAAO,IAAP,EAAa;yBACX,WAAW,SAAS,EAAT,CAAY,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAZ,CAAX,GAAyD,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAzD,CADW;aAAjB,MAEA,IAAI,OAAO,KAAP,EAAc;yBACZ,WAAW,SAAS,EAAT,CAAY,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAZ,CAAX,GAAyD,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,EAAyB,EAAzB,CAA4B,CAA5B,CAAzD,CADY;aAAlB,MAEA,IAAI,OAAO,aAAP,EAAsB;yBACpB,WAAW,SAAS,EAAT,CAAY,IAAI,KAAJ,EAAW,OAAX,CAAmB,EAAnB,EAAuB,eAAvB,CAAuC,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAlB,CAAvC,EAA8D,KAA9D,GAAsE,EAAtE,CAAyE,CAAzE,CAAZ,CAAX,GAAsG,IAAI,KAAJ,EAAW,OAAX,CAAmB,EAAnB,EAAuB,eAAvB,CAAuC,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAlB,CAAvC,EAA8D,KAA9D,GAAsE,EAAtE,CAAyE,CAAzE,CAAtG,CADoB;aAA1B,MAEA,IAAI,OAAO,gBAAP,EAAyB;yBACvB,WAAW,SAAS,EAAT,CAAY,IAAI,KAAJ,EAAW,OAAX,CAAmB,EAAnB,EAAuB,eAAvB,CAAuC,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAlB,CAAvC,EAA8D,KAA9D,GAAsE,EAAtE,CAAyE,CAAzE,CAAZ,CAAX,GAAsG,IAAI,KAAJ,EAAW,OAAX,CAAmB,EAAnB,EAAuB,eAAvB,CAAuC,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAlB,CAAvC,EAA8D,KAA9D,GAAsE,EAAtE,CAAyE,CAAzE,CAAtG,CADuB;aAA7B,MAEA,IAAI,OAAO,KAAP,EAAc;yBACZ,WAAW,SAAS,EAAT,CAAY,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAE,IAAF,CAAO,EAAP,CAAlB,EAA8B,QAA9B,CAAuC,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,CAAvC,CAAZ,CAAX,GAA2F,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAE,IAAF,CAAO,EAAP,CAAlB,EAA8B,QAA9B,CAAuC,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,CAAvC,CAA3F,CADY;aAAlB,MAEA,IAAI,OAAO,QAAP,EAAiB;yBACf,WAAW,SAAS,EAAT,CAAY,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAE,IAAF,CAAO,EAAP,CAAlB,EAA8B,QAA9B,CAAuC,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,CAAvC,EAAiE,GAAjE,EAAZ,CAAX,GAAiG,EAAE,IAAF,CAAO,CAAP,EAAU,OAAV,CAAkB,EAAE,IAAF,CAAO,EAAP,CAAlB,EAA8B,QAA9B,CAAuC,IAAI,KAAJ,EAAW,OAAX,CAAmB,IAAnB,CAAvC,EAAiE,GAAjE,EAAjG,CADe;aAArB;WAvCQ,CAAjB,CAJ8C;SAA3B,CAArB,CAF4B;eAkDrB,QAAP,CAlD4B;OAAT,CAArB,CAD0B;KAA5B;;QAuDI,OAAO,OAAP,EAAgB;UACd,SAAS,OAAO,OAAP,CAAb,EAA8B;eACrB,OAAP,GAAiB,CACf,CAAC,OAAO,OAAP,EAAgB,KAAjB,CADe,CAAjB,CAD4B;OAA9B;WAKK,IAAI,IAAI,CAAJ,EAAO,IAAI,OAAO,OAAP,CAAe,MAAf,EAAuB,GAA3C,EAAgD;YAC1C,SAAS,OAAO,OAAP,CAAe,CAAf,CAAT,CAAJ,EAAiC;iBACxB,OAAP,CAAe,CAAf,IAAoB,CAAC,OAAO,OAAP,CAAe,CAAf,CAAD,EAAoB,KAApB,CAApB,CAD+B;SAAjC;gBAGQ,UAAU,OAAO,OAAP,CAAe,CAAf,EAAkB,CAAlB,CAAV,MAAoC,MAApC,GAA6C,MAAM,OAAN,CAAc,EAAE,IAAF,CAAO,OAAO,OAAP,CAAe,CAAf,EAAkB,CAAlB,CAAP,CAAd,CAA7C,GAA2F,MAAM,OAAN,CAAc,OAAO,OAAP,CAAe,CAAf,EAAkB,CAAlB,CAAd,CAA3F,CAJsC;OAAhD;KANF;;QAcI,OAAO,IAAP,EAAa;cACP,MAAM,IAAN,CAAW,CAAC,OAAO,IAAP,CAApB,CADe;KAAjB;;QAII,OAAO,KAAP,EAAc;cACR,MAAM,KAAN,CAAY,CAAC,OAAO,KAAP,CAArB,CADgB;KAAlB;;WAIO,KAAP,CApGgC;GAde;gCAqHtC,MAAM;QACT,OAAO,IAAP,CADS;WAER,QAAQ,EAAR,CAFQ;QAGX,KAAK,KAAK,EAAL,IAAW,KAAK,QAAL,CAAc,EAAd,CAHL;QAIX,CAAC,KAAK,SAAL,CAAe,EAAf,CAAD,EAAqB;WAClB,SAAL,CAAe,EAAf,IAAqB,KAAK,CAAL,CAAO,MAAP,CACnB,KAAK,CAAL,CAAO,MAAP,GAAgB,QAAhB,CAAyB,EAAzB,CADmB,EAEnB,IAFmB,EAGnB,KAAK,CAAL,CAAO,QAAP,CAAgB,EAAhB,CAHmB,EAInB,GAJmB,EAArB,CADuB;KAAzB;WAOO,KAAK,SAAL,CAAe,EAAf,CAAP,CAXe;GArHgC;;;;;;;;;;;;;0BA6IzC,UAAU,OAAO,MAAM;QACvB,OAAO,IAAP,CADuB;YAErB,eAAe,KAAK,KAAL,EAAY,SAAS,cAAT,IAA2B,EAA3B,CAA3B,CAAR,CAF6B;aAGpB,OAAO,EAAP,CAAT,CAH6B;;WAKtB,KAAK,YAAL,CAAkB,SAAS,KAAT,IAAkB,WAAW,SAAS,IAAT,CAA7B,EAA6C,IAA/D,EAAqE,IAArE,CAA0E,YAAY;aACpF,KAAK,WAAL,CAAiB,QAAjB,EAA2B,IAA3B,EAAiC,MAAjC,CAAwC,KAAxC,EAA+C,EAAC,eAAe,IAAf,EAAhD,EAAsE,GAAtE,EAAP,CAD2F;KAAZ,CAA1E,CAEJ,IAFI,CAEC,UAAU,MAAV,EAAkB;WACnB,aAAL,CAAmB,MAAnB,EADwB;aAEjB,OAAO,OAAP,CAAe,CAAf,EAAkB,OAAlB,CAFiB;KAAlB,CAFR,CAL6B;GA7IkB;;;;;;;;;;;;;4BAoKxC,UAAU,IAAI,MAAM;QACrB,OAAO,IAAP,CADqB;aAElB,OAAO,EAAP,CAAT,CAF2B;;WAIpB,KAAK,YAAL,CAAkB,SAAS,KAAT,IAAkB,WAAW,SAAS,IAAT,CAA7B,EAA6C,IAA/D,EAAqE,IAArE,CAA0E,YAAY;aACpF,KAAK,WAAL,CAAiB,QAAjB,EAA2B,IAA3B,EAAiC,GAAjC,CAAqC,EAArC,EAAyC,MAAzC,GAAkD,GAAlD,EAAP,CAD2F;KAAZ,CAA1E,CAEJ,IAFI,CAEC,YAAY;aACX,SAAP,CADkB;KAAZ,CAFR,CAJ2B;GApKoB;;;;;;;;;;;;;kCAyLrC,UAAU,OAAO,MAAM;QAC3B,OAAO,IAAP,CAD2B;cAEvB,QAAQ,EAAR,CAAV,CAFiC;aAGxB,OAAO,EAAP,CAAT,CAHiC;;WAK1B,KAAK,YAAL,CAAkB,SAAS,KAAT,IAAkB,WAAW,SAAS,IAAT,CAA7B,EAA6C,IAA/D,EAAqE,IAArE,CAA0E,YAAY;aACpF,KAAK,cAAL,CAAoB,KAAK,WAAL,CAAiB,QAAjB,EAA2B,IAA3B,CAApB,EAAsD,KAAtD,EAA6D,MAA7D,GAAsE,GAAtE,EAAP,CAD2F;KAAZ,CAA1E,CAEJ,IAFI,CAEC,YAAY;aACX,SAAP,CADkB;KAAZ,CAFR,CALiC;GAzLc;;;;;;;;;;;;;wDA+M1B,UAAU,KAAK,QAAQ;WACrC,QAAQ,GAAR,CAAY,MAAZ,EAAoB,SAAS,WAAT,CAA3B,CAD4C;GA/MG;;;;;;;;;;oCA0NpC,UAAU,KAAK,SAAS,WAAW;QACxC,OAAO,IAAP,CADwC;QAE1C,WAAW,KAAX,CAF0C;;QAI1C,QAAQ,QAAR,CAAiB,OAAjB,KAA6B,CAAC,QAAQ,OAAR,CAAgB,OAAhB,CAAD,EAA2B;iBAC/C,IAAX,CAD0D;gBAEhD,CAAC,OAAD,CAAV,CAF0D;KAA5D;QAIM,MAAM,QAAQ,GAAR,CAAY,UAAU,MAAV,EAAkB;aACjC,KAAK,qBAAL,CAA2B,QAA3B,EAAqC,GAArC,EAA0C,MAA1C,CAAP,CADwC;KAAlB,CAAlB,CARwC;QAWxC,QAAQ,EAAR,CAXwC;QAYxC,WAAW,MAAM,IAAI,UAAJ,CAAN,GAAwB,EAAxB,CAZ6B;QAa1C,QAAJ,EAAc;;eAEH,IAAT,IAAiB,IAAI,CAAJ,CAAjB,CAFY;KAAd,MAGO;eACI,IAAT,IAAiB,IAAI,MAAJ,CAAW,UAAU,EAAV,EAAc;eACjC,EAAP,CADwC;OAAd,CAA5B,CADK;KAHP;WAQO,KAAK,OAAL,CAAa,SAAS,WAAT,CAAqB,IAAI,QAAJ,CAAlC,EAAiD,KAAjD,EAAwD,SAAxD,EAAmE,IAAnE,CAAwE,UAAU,YAAV,EAAwB;cAC7F,OAAR,CAAgB,UAAU,MAAV,EAAkB;YAC5B,WAAW,EAAX;;YAEA,QAAJ,EAAc;qBACD,YAAX,CADY;SAAd,MAEO;uBACQ,OAAb,CAAqB,UAAU,WAAV,EAAuB;gBACtC,QAAQ,GAAR,CAAY,WAAZ,EAAyB,IAAI,UAAJ,CAAzB,KAA6C,OAAO,SAAS,WAAT,CAApD,EAA2E;uBACpE,IAAT,CAAc,WAAd,EAD6E;aAA/E;WADmB,CAArB,CADK;SAFP;gBASQ,GAAR,CAAY,MAAZ,EAAoB,IAAI,UAAJ,EAAgB,QAApC,EAZgC;OAAlB,CAAhB,CADqG;KAAxB,CAA/E,CArB8C;GA1NC;;;;;;;;;;kCAwQrC,UAAU,KAAK,SAAS,WAAW;QACzC,QAAQ,QAAR,CAAiB,OAAjB,KAA6B,CAAC,QAAQ,OAAR,CAAgB,OAAhB,CAAD,EAA2B;gBAChD,CAAC,OAAD,CAAV,CAD0D;KAA5D;WAGO,KAAK,WAAL,CAAiB,QAAjB,EAA2B,GAA3B,EAAgC,OAAhC,EAAyC,SAAzC,EAAoD,IAApD,CAAyD,YAAY;cAClE,OAAR,CAAgB,UAAU,MAAV,EAAkB;YAC1B,cAAc,QAAQ,GAAR,CAAY,MAAZ,EAAoB,IAAI,UAAJ,CAAlC,CAD0B;YAE5B,QAAQ,OAAR,CAAgB,WAAhB,KAAgC,YAAY,MAAZ,EAAoB;kBAC9C,GAAR,CAAY,MAAZ,EAAoB,IAAI,UAAJ,EAAgB,YAAY,CAAZ,CAApC,EADsD;SAAxD;OAFc,CAAhB,CAD0E;KAAZ,CAAhE,CAJ6C;GAxQE;;;;;;;;;;4DA6RxB,UAAU,KAAK,QAAQ;WACvC,QAAQ,GAAR,CAAY,MAAZ,EAAoB,IAAI,QAAJ,CAA3B,CAD8C;GA7RC;;;;;;;;;;wCAwSlC,UAAU,KAAK,SAAS,WAAW;QAC1C,OAAO,IAAP,CAD0C;QAE1C,cAAc,SAAS,WAAT,CAAqB,IAAI,QAAJ,CAAnC,CAF0C;;QAI5C,QAAQ,QAAR,CAAiB,OAAjB,KAA6B,CAAC,QAAQ,OAAR,CAAgB,OAAhB,CAAD,EAA2B;;YACpD,SAAS,OAAT;;aACC,KAAK,IAAL,CAAU,WAAV,EAAuB,KAAK,uBAAL,CAA6B,QAA7B,EAAuC,GAAvC,EAA4C,MAA5C,CAAvB,EAA4E,SAA5E,EAAuF,IAAvF,CAA4F,UAAU,WAAV,EAAuB;oBAChH,GAAR,CAAY,MAAZ,EAAoB,IAAI,UAAJ,EAAgB,WAApC,EADwH;WAAvB;SAAnG;UAF0D;;;KAA5D,MAKO;UACC,QAAO,QAAQ,GAAR,CAAY,UAAU,MAAV,EAAkB;eAClC,KAAK,uBAAL,CAA6B,QAA7B,EAAuC,GAAvC,EAA4C,MAA5C,CAAP,CADyC;OAAlB,CAAZ,CAEV,MAFU,CAEH,UAAU,GAAV,EAAe;eAChB,GAAP,CADuB;OAAf,CAFJ,CADD;aAME,KAAK,OAAL,CAAa,WAAb,EAA0B;+CAE5B,YAAY,WAAZ,EAA0B;gBACnB,KAAN;UAFJ;OADK,EAMJ,SANI,EAMO,IANP,CAMY,UAAU,YAAV,EAAwB;gBACjC,OAAR,CAAgB,UAAU,MAAV,EAAkB;uBACnB,OAAb,CAAqB,UAAU,WAAV,EAAuB;gBACtC,YAAY,YAAY,WAAZ,CAAZ,KAAyC,OAAO,IAAI,QAAJ,CAAhD,EAA+D;sBACzD,GAAR,CAAY,MAAZ,EAAoB,IAAI,UAAJ,EAAgB,WAApC,EADiE;aAAnE;WADmB,CAArB,CADgC;SAAlB,CAAhB,CADyC;OAAxB,CANnB,CANK;KALP;GA5S+C;;;;;;;;;;;;;;sBAoV3C,UAAU,IAAI,MAAM;QAClB,OAAO,IAAP,CADkB;aAEf,OAAO,EAAP,CAAT,CAFwB;SAGnB,IAAL,KAAc,KAAK,IAAL,GAAY,EAAZ,CAAd,CAHwB;;QAKpB,oBAAJ,CALwB;QAMlB,QAAQ,SAAS,KAAT,IAAkB,WAAW,SAAS,IAAT,CAA7B,CANU;QAOlB,eAAe,SAAS,YAAT,IAAyB,EAAzB,CAPG;QAQpB,QAAQ,CAAC,KAAK,YAAL,CAAkB,KAAlB,EAAyB,IAAzB,CAAD,CAAR,CARoB;;iBAUX,OAAb,CAAqB,UAAU,GAAV,EAAe;UAC5B,eAAe,IAAI,QAAJ,CADa;UAE5B,cAAc,SAAS,WAAT,CAAqB,YAArB,CAAd,CAF4B;UAG9B,CAAC,WAAD,EAAc;cACV,IAAI,OAAO,QAAP,CAAgB,GAAhB,CAAoB,YAAxB,CAAN,CADgB;OAAlB,MAEO,IAAI,CAAC,KAAK,IAAL,IAAa,CAAC,SAAS,KAAK,IAAL,EAAW,YAApB,CAAD,EAAoC;eAAA;OAAtD;UAGH,IAAI,UAAJ,EAAgB;cACZ,IAAN,CAAW,KAAK,YAAL,CAAkB,YAAY,KAAZ,IAAqB,WAAW,YAAY,IAAZ,CAAhC,EAAmD,IAAI,UAAJ,EAAgB,IAArF,CAAX,EADkB;OAApB,MAEO,IAAI,IAAI,QAAJ,EAAc;cACjB,IAAN,CAAW,KAAK,YAAL,CAAkB,SAAS,KAAT,IAAkB,WAAW,SAAS,IAAT,CAA7B,EAA6C,IAAI,QAAJ,EAAc,IAA7E,CAAX,EADuB;OAAlB;KAVY,CAArB,CAVwB;WAwBjB,QAAQ,OAAR,CAAgB,GAAhB,CAAoB,KAApB,EAA2B,IAA3B,CAAgC,YAAY;aAC1C,KAAK,WAAL,CAAiB,QAAjB,EAA2B,IAA3B,EAAiC,GAAjC,CAAqC,EAArC,EAAyC,GAAzC,EAAP,CADiD;KAAZ,CAAhC,CAEJ,IAFI,CAEC,UAAU,SAAV,EAAqB;UACvB,CAAC,SAAD,EAAY;cACR,IAAI,KAAJ,CAAU,YAAV,CAAN,CADc;OAAhB;iBAGW,SAAX,CAJ2B;UAKvB,QAAQ,EAAR,CALuB;;mBAOd,OAAb,CAAqB,UAAU,GAAV,EAAe;YAC9B,eAAe,IAAI,QAAJ,CADe;YAE9B,cAAc,SAAS,WAAT,CAAqB,YAArB,CAAd,CAF8B;YAG9B,gBAAgB,IAAhB,CAH8B;YAI9B,KAAK,IAAL,CAAU,OAAV,CAAkB,YAAlB,MAAoC,CAAC,CAAD,EAAI;0BAC1B,YAAhB,CAD0C;SAA5C,MAEO,IAAI,KAAK,IAAL,CAAU,OAAV,CAAkB,IAAI,UAAJ,CAAlB,KAAsC,CAAC,CAAD,EAAI;0BACnC,IAAI,UAAJ,CADmC;SAA9C;YAGH,aAAJ,EAAmB;;gBACb,YAAY,QAAQ,SAAR,CAAkB,EAAlB,EAAsB,KAAK,IAAL,GAAY,KAAK,IAAL,EAAZ,GAA0B,IAA1B,CAAlC;sBACM,IAAV,GAAiB,KAAK,IAAL,CAAU,KAAV,EAAjB;wBACY,QAAQ,CAAR,CAAU,WAAV,EAAuB,SAAvB,CAAZ;oBACQ,MAAR,CAAe,UAAU,IAAV,EAAgB,aAA/B;sBACU,IAAV,CAAe,OAAf,CAAuB,UAAU,QAAV,EAAoB,CAApB,EAAuB;kBACxC,YAAY,SAAS,OAAT,CAAiB,aAAjB,MAAoC,CAApC,IAAyC,SAAS,MAAT,IAAmB,cAAc,MAAd,IAAwB,SAAS,cAAc,MAAd,CAAT,KAAmC,GAAnC,EAAwC;0BAChI,IAAV,CAAe,CAAf,IAAoB,SAAS,MAAT,CAAgB,cAAc,MAAd,GAAuB,CAAvB,CAApC,CAD0I;eAA5I,MAEO;0BACK,IAAV,CAAe,CAAf,IAAoB,EAApB,CADK;eAFP;aADqB,CAAvB;;gBAQI,gBAAJ;;gBAEI,IAAI,UAAJ,KAAmB,IAAI,IAAJ,KAAa,QAAb,IAAyB,IAAI,IAAJ,KAAa,SAAb,CAA5C,EAAqE;kBACnE,IAAI,IAAJ,KAAa,QAAb,EAAuB;uBAClB,KAAK,UAAL,CAAgB,QAAhB,EAA0B,GAA1B,EAA+B,QAA/B,EAAyC,SAAzC,CAAP,CADyB;eAA3B,MAEO;uBACE,KAAK,WAAL,CAAiB,QAAjB,EAA2B,GAA3B,EAAgC,QAAhC,EAA0C,SAA1C,CAAP,CADK;eAFP;aADF,MAMO,IAAI,IAAI,IAAJ,KAAa,SAAb,IAA0B,IAAI,SAAJ,EAAe;kBAC9C,YAAY,EAAZ,CAD8C;kBAE9C,WAAW,SAAS,IAAI,SAAJ,CAAT,IAA2B,EAA3B,CAFmC;yBAGvC,QAAQ,OAAR,CAAgB,QAAhB,IAA4B,QAA5B,GAAuC,QAAQ,IAAR,CAAa,QAAb,CAAvC,CAHuC;0BAItC,UAAU,MAAV,CAAiB,YAAY,EAAZ,CAA7B,CAJkD;qBAK3C,KAAK,OAAL,CAAa,SAAS,WAAT,CAAqB,YAArB,CAAb,EAAiD;uDAEnD,YAAY,WAAZ,EAA0B;wBACnB,OAAO,SAAP,EAAkB,MAAlB,CAAyB,UAAC,CAAD;2BAAO;mBAAP,CAA/B;kBAFJ;eADK,EAMJ,SANI,EAMO,IANP,CAMY,UAAU,YAAV,EAAwB;wBACjC,GAAR,CAAY,QAAZ,EAAsB,IAAI,UAAJ,EAAgB,YAAtC,EADyC;uBAElC,YAAP,CAFyC;eAAxB,CANnB,CALkD;aAA7C,MAeA,IAAI,IAAI,IAAJ,KAAa,WAAb,IAA6B,IAAI,IAAJ,KAAa,QAAb,IAAyB,IAAI,QAAJ,EAAe;qBACvE,KAAK,aAAL,CAAmB,QAAnB,EAA6B,GAA7B,EAAkC,QAAlC,EAA4C,SAA5C,CAAP,CAD8E;aAAzE;;gBAIH,IAAJ,EAAU;oBACF,IAAN,CAAW,IAAX,EADQ;aAAV;eAxCiB;SAAnB;OATmB,CAArB,CAP2B;;aA8DpB,QAAQ,OAAR,CAAgB,GAAhB,CAAoB,KAApB,CAAP,CA9D2B;KAArB,CAFD,CAiEJ,IAjEI,CAiEC,YAAY;aACX,QAAP,CADkB;KAAZ,CAjER,CAxBwB;GApVuB;;;;;;;;;;;;;;4BA6bxC,UAAU,OAAO,MAAM;QACxB,OAAO,IAAP,CADwB;aAErB,OAAO,EAAP,CAAT,CAF8B;SAGzB,IAAL,KAAc,KAAK,IAAL,GAAY,EAAZ,CAAd,CAH8B;;QAK1B,QAAQ,IAAR,CAL0B;QAMxB,QAAQ,SAAS,KAAT,IAAkB,WAAW,SAAS,IAAT,CAA7B,CANgB;QAOxB,eAAe,SAAS,YAAT,IAAyB,EAAzB,CAPS;QAQ1B,QAAQ,CAAC,KAAK,YAAL,CAAkB,KAAlB,EAAyB,IAAzB,CAAD,CAAR,CAR0B;;iBAUjB,OAAb,CAAqB,UAAU,GAAV,EAAe;UAC5B,eAAe,IAAI,QAAJ,CADa;UAE5B,cAAc,SAAS,WAAT,CAAqB,YAArB,CAAd,CAF4B;UAG9B,CAAC,WAAD,EAAc;cACV,IAAI,OAAO,QAAP,CAAgB,GAAhB,CAAoB,YAAxB,CAAN,CADgB;OAAlB,MAEO,IAAI,CAAC,KAAK,IAAL,IAAa,CAAC,SAAS,KAAK,IAAL,EAAW,YAApB,CAAD,EAAoC;eAAA;OAAtD;UAGH,IAAI,UAAJ,EAAgB;cACZ,IAAN,CAAW,KAAK,YAAL,CAAkB,YAAY,KAAZ,IAAqB,WAAW,YAAY,IAAZ,CAAhC,EAAmD,IAAI,UAAJ,EAAgB,IAArF,CAAX,EADkB;OAApB,MAEO,IAAI,IAAI,QAAJ,EAAc;cACjB,IAAN,CAAW,KAAK,YAAL,CAAkB,SAAS,KAAT,IAAkB,WAAW,SAAS,IAAT,CAA7B,EAA6C,IAAI,QAAJ,EAAc,IAA7E,CAAX,EADuB;OAAlB;KAVY,CAArB,CAV8B;WAwBvB,QAAQ,OAAR,CAAgB,GAAhB,CAAoB,KAApB,EAA2B,IAA3B,CAAgC,YAAY;aAC1C,KAAK,cAAL,CAAoB,KAAK,WAAL,CAAiB,QAAjB,EAA2B,IAA3B,CAApB,EAAsD,KAAtD,EAA6D,GAA7D,EAAP,CADiD;KAAZ,CAAhC,CAEJ,IAFI,CAEC,UAAU,MAAV,EAAkB;cAChB,MAAR,CADwB;UAEpB,QAAQ,EAAR,CAFoB;UAGlB,eAAe,SAAS,YAAT,IAAyB,EAAzB,CAHG;mBAIX,OAAb,CAAqB,UAAU,GAAV,EAAe;YAC9B,eAAe,IAAI,QAAJ,CADe;YAE9B,cAAc,SAAS,WAAT,CAAqB,YAArB,CAAd,CAF8B;YAG9B,gBAAgB,IAAhB,CAH8B;YAI9B,KAAK,IAAL,CAAU,OAAV,CAAkB,YAAlB,MAAoC,CAAC,CAAD,EAAI;0BAC1B,YAAhB,CAD0C;SAA5C,MAEO,IAAI,KAAK,IAAL,CAAU,OAAV,CAAkB,IAAI,UAAJ,CAAlB,KAAsC,CAAC,CAAD,EAAI;0BACnC,IAAI,UAAJ,CADmC;SAA9C;YAGH,aAAJ,EAAmB;;gBACb,YAAY,QAAQ,SAAR,CAAkB,EAAlB,EAAsB,KAAK,IAAL,GAAY,KAAK,IAAL,EAAZ,GAA0B,IAA1B,CAAlC;sBACM,IAAV,GAAiB,KAAK,IAAL,CAAU,KAAV,EAAjB;wBACY,QAAQ,CAAR,CAAU,WAAV,EAAuB,SAAvB,CAAZ;oBACQ,MAAR,CAAe,UAAU,IAAV,EAAgB,aAA/B;sBACU,IAAV,CAAe,OAAf,CAAuB,UAAU,QAAV,EAAoB,CAApB,EAAuB;kBACxC,YAAY,SAAS,OAAT,CAAiB,aAAjB,MAAoC,CAApC,IAAyC,SAAS,MAAT,IAAmB,cAAc,MAAd,IAAwB,SAAS,cAAc,MAAd,CAAT,KAAmC,GAAnC,EAAwC;0BAChI,IAAV,CAAe,CAAf,IAAoB,SAAS,MAAT,CAAgB,cAAc,MAAd,GAAuB,CAAvB,CAApC,CAD0I;eAA5I,MAEO;0BACK,IAAV,CAAe,CAAf,IAAoB,EAApB,CADK;eAFP;aADqB,CAAvB;;gBAQI,gBAAJ;;gBAEI,IAAI,UAAJ,KAAmB,IAAI,IAAJ,KAAa,QAAb,IAAyB,IAAI,IAAJ,KAAa,SAAb,CAA5C,EAAqE;kBACnE,IAAI,IAAJ,KAAa,SAAb,EAAwB;uBACnB,KAAK,WAAL,CAAiB,QAAjB,EAA2B,GAA3B,EAAgC,KAAhC,EAAuC,SAAvC,CAAP,CAD0B;eAA5B,MAEO;uBACE,KAAK,UAAL,CAAgB,QAAhB,EAA0B,GAA1B,EAA+B,KAA/B,EAAsC,SAAtC,CAAP,CADK;eAFP;aADF,MAMO,IAAI,IAAI,IAAJ,KAAa,SAAb,IAA0B,IAAI,SAAJ,EAAe;;oBAC9C,YAAY,EAAZ;sBACE,OAAN,CAAc,UAAU,IAAV,EAAgB;sBACxB,WAAW,KAAK,IAAI,SAAJ,CAAL,IAAuB,EAAvB,CADa;6BAEjB,QAAQ,OAAR,CAAgB,QAAhB,IAA4B,QAA5B,GAAuC,OAAO,IAAP,CAAY,QAAZ,CAAvC,CAFiB;8BAGhB,UAAU,MAAV,CAAiB,YAAY,EAAZ,CAA7B,CAH4B;iBAAhB,CAAd;uBAKO,KAAK,OAAL,CAAa,SAAS,WAAT,CAAqB,YAArB,CAAb,EAAiD;yDAEnD,YAAY,WAAZ,EAA0B;0BACnB,OAAO,SAAP,EAAkB,MAAlB,CAAyB,UAAC,CAAD;6BAAO;qBAAP,CAA/B;oBAFJ;iBADK,EAMJ,SANI,EAMO,IANP,CAMY,UAAU,YAAV,EAAwB;wBACnC,OAAN,CAAc,UAAU,IAAV,EAAgB;wBACxB,WAAW,EAAX,CADwB;wBAExB,WAAW,KAAK,IAAI,SAAJ,CAAL,IAAuB,EAAvB,CAFa;+BAGjB,QAAQ,OAAR,CAAgB,QAAhB,IAA4B,QAA5B,GAAuC,QAAQ,IAAR,CAAa,QAAb,CAAvC,CAHiB;iCAIf,OAAb,CAAqB,UAAU,WAAV,EAAuB;0BACtC,YAAY,SAAS,OAAT,CAAiB,YAAY,YAAY,WAAZ,CAA7B,MAA2D,CAAC,CAAD,EAAI;iCACpE,IAAT,CAAc,WAAd,EAD6E;uBAA/E;qBADmB,CAArB,CAJ4B;4BASpB,GAAR,CAAY,IAAZ,EAAkB,IAAI,UAAJ,EAAgB,QAAlC,EAT4B;mBAAhB,CAAd,CADyC;yBAYlC,YAAP,CAZyC;iBAAxB,CANnB;mBAPkD;aAA7C,MA2BA,IAAI,IAAI,IAAJ,KAAa,WAAb,IAA6B,IAAI,IAAJ,KAAa,QAAb,IAAyB,IAAI,QAAJ,EAAe;qBACvE,KAAK,aAAL,CAAmB,QAAnB,EAA6B,GAA7B,EAAkC,KAAlC,EAAyC,SAAzC,CAAP,CAD8E;aAAzE;;gBAIH,IAAJ,EAAU;oBACF,IAAN,CAAW,IAAX,EADQ;aAAV;eApDiB;SAAnB;OATmB,CAArB,CAJwB;aAsEjB,QAAQ,OAAR,CAAgB,GAAhB,CAAoB,KAApB,CAAP,CAtEwB;KAAlB,CAFD,CAyEJ,IAzEI,CAyEC,YAAY;aACX,KAAP,CADkB;KAAZ,CAzER,CAxB8B;GA7biB;;;;;;;;;;;;;;0BA8iBzC,gBAAgB,IAAI,OAAO,SAAS;;;YAClC,eAAe,KAAK,KAAL,EAAY,eAAe,cAAf,IAAiC,EAAjC,CAA3B,CAAR,CAD0C;cAEhC,WAAW,EAAX,CAFgC;WAGnC,KAAK,YAAL,CAAkB,eAAe,KAAf,IAAwB,WAAW,eAAe,IAAf,CAAnC,EAAyD,OAA3E,EAAoF,IAApF,CAAyF,YAAM;aAC7F,MAAK,CAAL,CAAO,EAAP,CAAU,QAAQ,EAAR,IAAc,MAAK,QAAL,CAAc,EAAd,CAAxB,CAA0C,KAA1C,CAAgD,eAAe,KAAf,IAAwB,WAAW,eAAe,IAAf,CAAnC,CAAhD,CAAyG,GAAzG,CAA6G,EAA7G,EAAiH,MAAjH,CAAwH,KAAxH,EAA+H,EAAC,eAAe,IAAf,EAAhI,EAAsJ,GAAtJ,EAAP,CADoG;KAAN,CAAzF,CAEJ,IAFI,CAEC,UAAC,MAAD,EAAY;YACb,aAAL,CAAmB,MAAnB,EADkB;UAEd,OAAO,OAAP,IAAkB,OAAO,OAAP,CAAe,MAAf,IAAyB,OAAO,OAAP,CAAe,CAAf,EAAkB,OAAlB,EAA2B;eACjE,OAAO,OAAP,CAAe,CAAf,EAAkB,OAAlB,CADiE;OAA1E,MAEO;eACE,MAAK,WAAL,CAAiB,cAAjB,EAAiC,OAAjC,EAA0C,GAA1C,CAA8C,EAA9C,EAAkD,GAAlD,EAAP,CADK;OAFP;KAFM,CAFR,CAH0C;GA9iBK;;;;;;;;;;;;;;gCAwkBtC,gBAAgB,OAAO,QAAQ,SAAS;;;YACzC,eAAe,KAAK,KAAL,EAAY,eAAe,cAAf,IAAiC,EAAjC,CAA3B,CAAR,CADiD;cAEvC,WAAW,EAAX,CAFuC;aAGxC,UAAU,EAAV,CAHwC;WAI1C,KAAK,YAAL,CAAkB,eAAe,KAAf,IAAwB,WAAW,eAAe,IAAf,CAAnC,EAAyD,OAA3E,EAAoF,IAApF,CAAyF,YAAM;aAC7F,OAAK,cAAL,CAAoB,OAAK,WAAL,CAAiB,cAAjB,EAAiC,OAAjC,CAApB,EAA+D,MAA/D,EAAuE,MAAvE,CAA8E,KAA9E,EAAqF,EAAC,eAAe,IAAf,EAAtF,EAA4G,GAA5G,EAAP,CADoG;KAAN,CAAzF,CAEJ,IAFI,CAEC,UAAC,MAAD,EAAY;aACb,aAAL,CAAmB,MAAnB,EADkB;UAEd,UAAU,OAAO,OAAP,IAAkB,OAAO,OAAP,CAAe,MAAf,EAAuB;;cACjD,QAAQ,EAAR;iBACG,OAAP,CAAe,OAAf,CAAuB,UAAC,MAAD;mBAAY,MAAM,IAAN,CAAW,OAAO,OAAP;WAAvB,CAAvB;;eACO;WAAP;YAHqD;;;OAAvD,MAIO;eACE,OAAK,cAAL,CAAoB,OAAK,WAAL,CAAiB,cAAjB,EAAiC,OAAjC,CAApB,EAA+D,MAA/D,EAAuE,GAAvE,EAAP,CADK;OAJP;KAFM,CAFR,CAJiD;GAxkBF;sCA0lBnC,OAAO,SAAS;;;cAClB,WAAW,EAAX,CADkB;QAExB,KAAK,QAAQ,EAAR,IAAc,KAAK,QAAL,CAAc,EAAd,CAFK;WAGrB,KAAK,SAAL,CAAe,OAAf,EAAwB,IAAxB,CAA6B,YAAM;aACnC,MAAL,CAAY,EAAZ,IAAkB,OAAK,MAAL,CAAY,EAAZ,KAAmB,EAAnB,CADsB;UAEpC,CAAC,OAAK,MAAL,CAAY,EAAZ,EAAgB,KAAhB,CAAD,EAAyB;eACtB,MAAL,CAAY,EAAZ,EAAgB,KAAhB,IAAyB,OAAK,CAAL,CAAO,MAAP,CAAc,OAAK,CAAL,CAAO,EAAP,CAAU,EAAV,EAAc,SAAd,GAA0B,QAA1B,CAAmC,KAAnC,CAAd,EAAyD,IAAzD,EAA+D,OAAK,CAAL,CAAO,EAAP,CAAU,EAAV,EAAc,WAAd,CAA0B,KAA1B,CAA/D,EAAiG,GAAjG,EAAzB,CAD2B;OAA7B;aAGO,OAAK,MAAL,CAAY,EAAZ,EAAgB,KAAhB,CAAP,CALwC;KAAN,CAApC,CAH4B;GA1lBmB;sCAsmBnC,OAAO,OAAO,SAAS;;;cACzB,WAAW,EAAX,CADyB;QAE/B,KAAK,QAAQ,EAAR,IAAc,KAAK,QAAL,CAAc,EAAd,CAFY;WAG5B,KAAK,SAAL,CAAe,OAAf,EAAwB,IAAxB,CAA6B;aAAM,OAAK,YAAL,CAAkB,KAAlB,EAAyB,OAAzB;KAAN,CAA7B,CAAsE,IAAtE,CAA2E,YAAM;aACjF,OAAL,CAAa,EAAb,IAAmB,OAAK,OAAL,CAAa,EAAb,KAAoB,EAApB,CADmE;aAEjF,OAAL,CAAa,EAAb,EAAiB,KAAjB,IAA0B,OAAK,OAAL,CAAa,EAAb,EAAiB,KAAjB,KAA2B,EAA3B,CAF4D;UAGlF,CAAC,OAAK,MAAL,CAAY,EAAZ,EAAgB,KAAhB,EAAuB,KAAvB,CAAD,EAAgC;eAC7B,MAAL,CAAY,EAAZ,EAAgB,KAAhB,EAAuB,KAAvB,IAAgC,OAAK,CAAL,CAAO,MAAP,CAAc,OAAK,CAAL,CAAO,EAAP,CAAU,EAAV,EAAc,KAAd,CAAoB,KAApB,EAA2B,SAA3B,GAAuC,QAAvC,CAAgD,KAAhD,CAAd,EAAsE,IAAtE,EAA4E,OAAK,CAAL,CAAO,EAAP,CAAU,EAAV,EAAc,KAAd,CAAoB,KAApB,EAA2B,WAA3B,CAAuC,KAAvC,CAA5E,EAA2H,GAA3H,GAAiI,IAAjI,CAAsI,YAAM;iBACnK,OAAK,CAAL,CAAO,EAAP,CAAU,EAAV,EAAc,KAAd,CAAoB,KAApB,EAA2B,SAA3B,CAAqC,KAArC,EAA4C,GAA5C,EAAP,CAD0K;SAAN,CAAtK,CADkC;OAApC;aAKO,OAAK,MAAL,CAAY,EAAZ,EAAgB,KAAhB,EAAuB,KAAvB,CAAP,CARsF;KAAN,CAAlF,CAHmC;GAtmBY;CAAnD;;"}